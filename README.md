# Телеграм-бот для марафона "Любовь и Деньги"

Бот на aiogram для регистрации участников и автоматической рассылки напоминаний о эфирах марафона.

## Функционал

- Регистрация участников через кнопку "Участвовать"
- Проверка подписки на все каналы спикеров
- Автоматическая рассылка напоминаний:
  - За сутки до эфира
  - За час до эфира
  - За 5 минут до эфира
  - После эфира
- Сообщения о завершении марафона и розыгрыше призов

## Установка и запуск

### 1. Создайте файл `.env` в корне проекта:

Скопируйте содержимое из `env_template.txt` в файл `.env` и заполните значения:

```env
BOT_TOKEN=your_bot_token_here
ADMIN_ID=your_admin_telegram_id
# Можно указать несколько админов через запятую:
# ADMIN_ID=123456789,987654321,111222333

# Каналы для проверки подписки
CHANNEL_MAIN=https://t.me/+TYsLvdiXw-czZTky
CHANNEL_OKSANA=https://t.me/oks_toruss
CHANNEL_NATALIA=https://t.me/sreda_eksperta
CHANNEL_MARIA=https://t.me/prostoshevelis

# ID каналов (можно получить через @userinfobot или другие боты)
CHANNEL_MAIN_ID=-1001234567890
CHANNEL_OKSANA_ID=-1001234567891
CHANNEL_NATALIA_ID=-1001234567892
CHANNEL_MARIA_ID=-1001234567893
```

**Важно:** 
- Получите токен бота у [@BotFather](https://t.me/BotFather)
- Ваш ADMIN_ID можно узнать у [@userinfobot](https://t.me/userinfobot)
- Можно указать несколько админов через запятую: `ADMIN_ID=123456789,987654321`

### 2. Получение ID каналов

Чтобы получить ID канала:
1. Добавьте бота @userinfobot в канал
2. Отправьте любое сообщение в канал
3. Бот покажет ID канала

Или используйте бота @RawDataBot - добавьте его в канал и он покажет ID.

### 3. Запуск через Docker Compose

```bash
docker-compose up -d
```

### 4. Запуск без Docker

```bash
pip install -r requirements.txt
python bot.py
```

## Команды бота

### Для пользователей:
- `/start` - Начать работу с ботом

### Для администратора:
- `/stats` - Статистика зарегистрированных пользователей
- `/send` - Отправка сообщения всем зарегистрированным пользователям
  - Поддерживает текст и фото с подписью
  - Есть кнопка отмены
  - Показывает превью перед отправкой

## Структура проекта

```
.
├── bot.py              # Основной файл бота
├── config.py           # Конфигурация
├── database.py         # Работа с базой данных
├── messages.py         # Тексты сообщений
├── scheduler.py        # Планировщик рассылок
├── requirements.txt    # Зависимости
├── Dockerfile          # Docker образ
├── docker-compose.yml  # Docker Compose конфигурация
└── README.md          # Документация
```

## Примечания

- База данных SQLite сохраняется в папке `data/`
- Планировщик проверяет время каждую минуту
- Все даты и время указаны в московском времени (MSK)
- Убедитесь, что бот добавлен во все каналы как администратор для проверки подписок

